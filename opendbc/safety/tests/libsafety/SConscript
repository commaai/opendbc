import os
import platform

system = platform.system()

env = Environment(
  CC='clang',
  CFLAGS=[
    '-Wall',
    "-Wextra",
    '-Werror',
    '-nostdlib',
    '-fno-builtin',
    '-std=gnu11',
    '-Wfatal-errors',
    '-Wno-pointer-to-int-cast',
    '-g',
    '-O0',
    '-fno-omit-frame-pointer',
    '-grecord-command-line',
    '-fprofile-arcs',
    '-ftest-coverage',
    '-DALLOW_DEBUG',
  ],
  LINKFLAGS=[
    '-fsanitize=undefined',
    '-fno-sanitize-recover=undefined',
    '-fprofile-arcs',
    '-ftest-coverage',
  ],
  CPPPATH=["#"],
  tools=["default", "compilation_db"],
)

safety = env.SharedObject("safety.os", "safety.c")
libsafety = env.SharedLibrary("libsafety.so", [safety])

# GCC-style note file is generated by compiler, allow scons to clean it up
env.SideEffect("safety.gcno", safety)
